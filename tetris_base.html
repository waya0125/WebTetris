<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta property="og:title" content="">
        <meta property="og:type" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">

        <link rel="manifest" href="site.webmanifest">
        <link rel="apple-touch-icon" href="icon.png">
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">

        <meta name="theme-color" content="#fafafa">

        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

        <style>
            *{
                padding: 0;
                margin: 0;
            }

            /* „Ç≤„Éº„É†ÁîªÈù¢Ë°®Á§∫Â†¥ÊâÄ„ÅÆÂ§ß„Åç„Åï„Å®„Åã */
            #display {
                width: calc(24px * 12);
                height: calc(24px * 22);
            }

            /* 1„Éû„Çπ„ÅÆÂ§ß„Åç„Åï„Å®„ÅãËâ≤(„Éá„Éï„Ç©„É´„Éà Èªí) */
            .cell {
                width: 22px;
                height: 22px;
                display:block;
                float: left;
                background-color: rgb(32, 32, 32);
                border-left: 1px solid rgb(64, 64, 64);
                border-top: 1px solid rgb(64, 64, 64);
                border-right: 1px solid rgb(16, 16, 16);
                border-bottom: 1px solid rgb(16, 16, 16);
            }

            /* Â§ñÂÅ¥„ÅÆÂ£ÅÁî®„ÅÆ„Éû„Çπ„ÅÆËâ≤(ÁÅ∞Ëâ≤) */
            .wall {
                background-color: rgb(128, 128, 128);
                border-left: 1px solid rgb(192, 192, 192);
                border-top: 1px solid rgb(192, 192, 192);
                border-right: 1px solid rgb(64, 64, 64);
                border-bottom: 1px solid rgb(64, 64, 64);
            }

            /* Ê∞¥Ëâ≤ */
            .I {
                background-color: #3399ff;
                border-left: 1px solid #99ccff;
                border-top: 1px solid #99ccff;
                border-right: 1px solid #0066ff;
                border-bottom: 1px solid #0066ff;
            }

            /* Á¥´Ëâ≤ */
            .T {
                background-color: #cc33cc;
                border-left: 1px solid #cc66cc;
                border-top: 1px solid #cc66cc;
                border-right: 1px solid #cc00cc;
                border-bottom: 1px solid #cc00cc;
            }

            /* ÈªÑËâ≤ */
            .O {
                background-color: #ccff00;
                border-left: 1px solid #ffff00;
                border-top: 1px solid #ffff00;
                border-right: 1px solid #99cc00;
                border-bottom: 1px solid #99cc00;
            }

            /* Ëµ§Ëâ≤ */
            .Z {
                background-color: #ff0033;
                border-left: 1px solid #cc3366;
                border-top: 1px solid #cc3366;
                border-right: 1px solid #cc0033;
                border-bottom: 1px solid #cc0033;
            }

            /* ÈªÑÁ∑ëËâ≤ */
            .S {
                background-color: #66cc33;
                border-left: 1px solid #99ff66;
                border-top: 1px solid #99ff66;
                border-right: 1px solid #339900;
                border-bottom: 1px solid #339900;
            }

            /* „Ç™„É¨„É≥„Ç∏Ëâ≤ */
            .L {
                background-color: #ff6600;
                border-left: 1px solid #ff9966;
                border-top: 1px solid #ff9966;
                border-right: 1px solid #cc6633;
                border-bottom: 1px solid #cc6633;
            }

            /* ÈùíËâ≤ */
            .J {
                background-color: #0033cc;
                border-left: 1px solid #0066ff;
                border-top: 1px solid #0066ff;
                border-right: 1px solid #000099;
                border-bottom: 1px solid #000099;
            }

            /* „Éú„Çø„É≥ */
            #rotate, #left, #up, #right, #down {
                width: 48px;
                height: 48px;
                font-size: 32px;
            }
        </style>
    </head>
    <body>
        <!-- Add your site or application content here -->
        <p>Hello world! This is HTML5 Boilerplate.</p>

        <!-- Ë°®Á§∫Â†¥ÊâÄ -->
        <div id="display"></div>
        <div id="buttons">
        <input type="button" id="rotate" value="üîÅ">
        <input type="button" id="left" value="‚Üê">
        <input type="button" id="up" value="‚Üë">
        <input type="button" id="right" value="‚Üí">
        <input type="button" id="down" value="‚Üì">
        </div>

        <script>
        // „Éñ„É≠„ÉÉ„ÇØ„ÅÆ„Åß„Éº„Åü
        function Block(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type;
        this.status = 0;
        }
        var block = new Block(4, 0, Math.floor(Math.random() * (7)));
        let fps = 1000 / 60;
        let field_width = 12;
        let field_height = 22;
        let Cell = {
        None : 0,
        Wall : 1,
        I : 2,
        O : 3,
        S : 4,
        Z : 5,
        J : 6,
        L : 7,
        T : 8,
        };
        // „Ç´„Ç¶„É≥„Çø
        var cnt = 0;

        // Âá∫ÂäõÁî®„É°„É¢„É™
        var vram = [
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1,1,1],
        ];

        // „Ç≤„Éº„É†„ÇíÁÆ°ÁêÜ„Åô„Çã„Åü„ÇÅ„ÅÆ„Éï„Ç£„Éº„É´„Éâ
        var field = [
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1,1,1],
        ];

        // ÂêÑ„Éñ„É≠„ÉÉ„ÇØ„ÅÆÁä∂ÊÖã„ÅÆÊï∞ - 1
        let block_status = [1, 0, 1, 1, 3, 3, 3]
        // ÂêÑ„Éñ„É≠„ÉÉ„ÇØ„ÇíÊ†ºÁ¥ç„Åô„Çã
        let blocks = [
        [ // I
        [
        [Cell.I,Cell.I,Cell.I,Cell.I]
        ],
        [
        [Cell.I],
        [Cell.I],
        [Cell.I],
        [Cell.I]
        ]
        ],
        [ // O
        [
        [Cell.O,Cell.O],
        [Cell.O,Cell.O]
        ]
        ],
        [ // S
        [
        [Cell.S,Cell.None],
        [Cell.S,Cell.S],
        [Cell.None,Cell.S]
        ],
        [
        [Cell.None,Cell.S,Cell.S],
        [Cell.S,Cell.S,Cell.None]
        ]
        ],
        [ // Z
        [
        [Cell.None,Cell.Z],
        [Cell.Z,Cell.Z],
        [Cell.Z,Cell.None]
        ],
        [
        [Cell.Z,Cell.Z,Cell.None],
        [Cell.None,Cell.Z,Cell.Z]
        ]
        ],
        [ // J
        [
        [Cell.None,Cell.J],
        [Cell.None,Cell.J],
        [Cell.J,Cell.J]
        ],
        [
        [Cell.J,Cell.None,Cell.None],
        [Cell.J,Cell.J,Cell.J]
        ],
        [
        [Cell.J,Cell.J],
        [Cell.J,Cell.None],
        [Cell.J,Cell.None]
        ],
        [
        [Cell.J,Cell.J,Cell.J],
        [Cell.None,Cell.None,Cell.J]
        ]
        ],
        [ // L
        [
        [Cell.L,Cell.None],
        [Cell.L,Cell.None],
        [Cell.L,Cell.L]
        ],
        [
        [Cell.L,Cell.L,Cell.L],
        [Cell.L,Cell.None,Cell.None]
        ],
        [
        [Cell.L,Cell.L],
        [Cell.None,Cell.L],
        [Cell.None,Cell.L]
        ],
        [
        [Cell.None,Cell.None,Cell.L],
        [Cell.L,Cell.L,Cell.L]
        ]
        ],
        [ // T
        [
        [Cell.T,Cell.None],
        [Cell.T,Cell.T],
        [Cell.T,Cell.None]
        ],
        [
        [Cell.T,Cell.T,Cell.T],
        [Cell.None,Cell.T,Cell.None]
        ],
        [
        [Cell.None,Cell.T],
        [Cell.T,Cell.T],
        [Cell.None,Cell.T]
        ],
        [
        [Cell.None,Cell.T,Cell.None],
        [Cell.T,Cell.T,Cell.T]
        ]
        ]
        ];

        // ÈÖçÂàó„Ç≥„Éî„Éº
        // sa : „Ç≥„Éî„ÉºÂÖÉÈÖçÂàó
        // da : „Ç≥„Éî„ÉºÂÖàÈÖçÂàó
        // sx : „Ç≥„Éî„ÉºÂÖÉ„ÅÆxÂ∫ßÊ®ô
        // sy : „Ç≥„Éî„ÉºÂÖÉ„ÅÆyÂ∫ßÊ®ô
        // dx : „Ç≥„Éî„ÉºÂÖà„ÅÆxÂ∫ßÊ®ô
        // dy : „Ç≥„Éî„ÉºÂÖà„ÅÆyÂ∫ßÊ®ô
        // width : „Ç≥„Éî„Éº„Åô„ÇãÂπÖ
        // height : „Ç≥„Éî„Éº„Åô„ÇãÈ´ò„Åï
        // ignore : „Ç≥„Éî„Éº„Åó„Å™„ÅÑÂÄ§
        let copy = function(sa, da, sx, sy, dx, dy, ignore) {
        let width = sa[0].length;
        let height = sa.length;

        for(var i = 0; i < height; i++) {
        for(var j = 0; j < width; j++) {
        if(sa[sy + i][sx + j] == ignore) continue;
        da[dy + i][dx + j] = sa[sy + i][sx + j];
        }
        }
        };

        // btype„Åßstatus„Å™„Éñ„É≠„ÉÉ„ÇØ„Åå(x, y)„Å™Â∫ßÊ®ô„Å´Ë®≠ÁΩÆ„Åß„Åç„Çã„Åã
        let checkOkeru = function(btype, status, x, y) {
        console.log("status => " + status);
        var b = blocks[btype][status];
        let w = b[0].length;
        let h = b.length;

        for(var i = y; i < y + h; i++) {
        for(var j = x; j < x + w; j++) {
        if(b[i-y][j-x] == Cell.None) continue;
        if(field[i][j] != Cell.None) return false;
        }
        }
        return true;
        };

        // vram„Çídisplay„Å∏Âá∫Âäõ(vram to html)
        let disp = function() {
        let d = document.getElementById("display"); // Âá∫ÂäõÂ†¥ÊâÄ„ÅÆË¶ÅÁ¥†„ÇíÂèñÂæó

        var s = ""; // display„Å∏Êõ∏„ÅçËæº„ÇÄhtml„ÇíÊ†ºÁ¥ç„Åô„ÇãÂ§âÊï∞

        for(var i = 0; i < field_height; i++) {
        for(var j = 0; j < field_width; j++) {
        s += "<div class='cell ";
        switch(vram[i][j]) {
        case Cell.Wall: s += "wall"; break;
        case Cell.I: s += "I"; break;
        case Cell.O: s += "O"; break;
        case Cell.S: s += "S"; break;
        case Cell.Z: s += "Z"; break;
        case Cell.J: s += "J"; break;
        case Cell.L: s += "L"; break;
        case Cell.T: s += "T"; break;
        case Cell.None: break;
        }
        s += "'></div>";
        }
        }

        d.innerHTML = s; // Ë¶ÅÁ¥†„Å´Êõ∏„ÅçËæº„Åø
        };

        // ÊèèÁîªÈñ¢‰øÇ
        let graph = function() {
        copy(field, vram, 0, 0, 0, 0, -1, 0); // vram„Å´field„Çí„Ç≥„Éî„Éº
        copy(blocks[block.type][block.status], vram, 0, 0, block.x, block.y, 0); // vram„Å´„Éñ„É≠„ÉÉ„ÇØ„Çí„Ç≥„Éî„Éº
        disp();
        };

        // Âá¶ÁêÜ
        let process = function() {
        if(checkOkeru(block.type, block.status, block.x, block.y + 1)) block.y++; // ÁΩÆ„Åë„Çã
        else next();  // ÁΩÆ„Åë„Å™„ÅÑ
        };

        // yË°åÁõÆ„ÇíÊ∂à„Åó„Å¶‰∏ä„ÅÆ„Éñ„É≠„ÉÉ„ÇØ„Çí‰∏ã„Åí„Çã
        let delline = function(y) {
        for(var i = y; i > 0; i--) {
        for(var j = 1; j < field_width - 1; j++) {
        field[i][j] = field[i-1][j];
        }
        }
        };

        // ÁΩÆ„Åë„Å™„Åè„Å™„Å£„Åü„Çâ
        let next = function() {
        // field„Å´Âõ∫ÂÆö
        copy(blocks[block.type][block.status], field, 0, 0, block.x, block.y, 0);

        // Ê∂à„Åõ„ÇãË°å„Åå„ÅÇ„Çã„ÅãË™ø„Åπ„Çã
        for(var i = 0; i < field_height - 1; i++){
        var cnt = 0;
        for(var j = 0; j < field_width; j++){
        cnt++;
        if(field[i][j] == Cell.None) break;
        }
        if(cnt == field_width) delline(i);
        }

        // Ê¨°„ÅÆ„Éñ„É≠„ÉÉ„ÇØ„ÇíÁôªÈå≤
        block.type = Math.floor(Math.random() * (7));
        block.x = 4;
        block.y = 0;
        block.status = 0;
        };

        // main loop
        let loop = function() {
        console.log(cnt++);
        process();
        setTimeout(loop, 1000);
        };

        // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
        document.getElementById("left").addEventListener("click", function() {
        if(checkOkeru(block.type, block.status, block.x - 1, block.y)) block.x--;
        });

        document.getElementById("up").addEventListener("click", function() {
        while(checkOkeru(block.type, block.status, block.x, block.y + 1)){
        block.y++;
        }
        next();
        });

        document.getElementById("down").addEventListener("click", function() {
        process();
        });

        document.getElementById("right").addEventListener("click", function() {
        if(checkOkeru(block.type, block.status, block.x + 1, block.y)) block.x++;
        });

        document.getElementById("rotate").addEventListener("click", function() {block.status++;
        if(block.status > block_status[block.type]) block.status = 0;
        if(!checkOkeru(block.type, block.status, block.x, block.y)){
        block.status--;
        if(block.status < 0) block.status = block_status[block.type];
        }
        });

        var rotateKey = true;

        document.addEventListener("keyup", function(e){
        switch(e.keyCode) {
        case 65: // 'a'
        case 83: // 's'
        rotateKey = true;
        break;

        }
        });

        // „Ç≠„Éº„Ç§„Éô„É≥„Éà
        document.addEventListener("keydown", function(e) {
        console.log("keycode = " + e.keyCode);
        switch(e.keyCode) {
        case 37: // ‚Üê
        if(checkOkeru(block.type, block.status, block.x - 1, block.y)) block.x--; // Â∑¶„Å´Âãï„Åã„Åõ„Çã„Å™„ÇâÂãï„Åã„Åô
        break;
        case 38:  // ‚Üë
        while(checkOkeru(block.type, block.status, block.x, block.y + 1)){  //  ‰∏ã„Åæ„ÅßÂãï„Åã„Åô
        block.y++;
        }
        next();
        break;
        case 39: // ‚Üí
        if(checkOkeru(block.type, block.status, block.x + 1, block.y)) block.x++; // Âè≥„Å´Âãï„Åã„Åõ„Çã„Å™„ÇâÂãï„Åã„Åô
        break;
        case 40: // ‚Üì
        process();  // ‰∏ã„Å´Âãï„Åã„Åõ„Çã„Å™„ÇâÂãï„Åã„Åô
        break;
        case 65: // 'a'
        if(!rotateKey) break;
        rotateKey = false;
        // Â∑¶„Å´ÂõûËª¢„Åß„Åç„Çã„Å™„ÇâÂõûËª¢„Åô„Çã
        block.status--;
        if(block.status < 0) block.status = block_status[block.type];
        if(!checkOkeru(block.type, block.status, block.x, block.y)) {
        block.status++;
        if(block.status > block_status[block.type]) block.status = 0;
        }
        break;
        case 83: // 's'
        // Âè≥„Å´ÂõûËª¢„Åß„Åç„Çã„Å™„ÇâÂõûËª¢„Åô„Çã
        if(!rotateKey) break;
        rotateKey = false;
        block.status++;
        if(block.status > block_status[block.type]) block.status = 0;
        if(!checkOkeru(block.type, block.status, block.x, block.y)){
        block.status--;
        if(block.status < 0) block.status = block_status[block.type];
        }
        break;
        }
        console.log("block_status => " + block.status);
        });

        setInterval(graph, fps);
        loop(); // „É°„Ç§„É≥„É´„Éº„Éó„ÇíÂÆüË°å
        </script>

        <script src="js/vendor/modernizr-3.11.2.min.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
    </body>
</html>
